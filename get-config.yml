- name: Import cleanup playbook
  import_playbook: _subpb_cleanup.yml

- name: Get commited configuration of devices
  hosts: all
  roles:
    - Juniper.junos
  gather_facts: no

  tasks:

    - name: Retrieve config + save at ~/ansible_tmp/{hostname}/{hostname}.{format}
      juniper_junos_config:
        retrieve: "committed"
        # format bei ausfuehrung per extra variable (-e) angeben:
        # ansible-playbook get-config.yml -e format=text|set|xml|json
        format: "{{ format }}"
        dest_dir: "{{ base_dir }}"
      register: response